#!/usr/bin/python
# -*- coding: utf-8 -*-

BASEPATH='./'


REMINDTYPEFILE='f'
REMINDTYPECMD ='c'
NOREMINDOUTPUT='noremind'
REMINDPIPE='remind -ga -k"echo %s" -'
REMINDFILES=[
{REMINDTYPEFILE:BASEPATH+'reminders-daily', 'txt':'Let yourself be reminded of some important stuff:\n'},
{REMINDTYPECMD:'wget -q -O- http://www.google.com/calendar/ical/8saefumocvgmlnep6jjescdsd8%40group.calendar.google.com/public/basic.ics | ./ical2rem.pl --lead-time 1 | '+REMINDPIPE, 'txt':'\nEuro 2016 schedule for today:\n'},
{REMINDTYPECMD:'cat '+BASEPATH+'reminders-remarkable','txt':'\nSome shit you find noteworthy:\n',NOREMINDOUTPUT:True},
]
SUBJECT='Teux Deux'
TEXT='''Good Morning Mirco!

$body
'''
BODY='''$txt$reminder'''
REMINDERLINE='* %s\n'


from string import Template
from subprocess import Popen, PIPE
import locale
try:
  locale.setlocale(locale.LC_ALL, 'de_DE')
except locale.Error:
  try:
    locale.setlocale(locale.LC_ALL, 'de_DE.utf8')
  except locale.Error:
    print "both de_DE and de_DE.utf8 could not be set"

import modules
from mailhelper import MIMEUTF8QPText

from constants import MAIN_EMAIL_ADDRESS, FROM_FOR_MAILS

mailtext={'body':''}

for o in modules.getoutput():
  if o:
    print(o)
  #mailtext['body'] += o

if not mailtext['body'] == '':
  mail = MIMEUTF8QPText(Template(TEXT).substitute(mailtext))
  mail['Subject'] = SUBJECT
  mail['From'] = FROM_FOR_MAILS
  mail['To'] = MAIN_EMAIL_ADDRESS
  #print mail
  p = Popen(["/usr/sbin/sendmail", "-t", "-oi"], stdin=PIPE)
  p.communicate(mail.as_string())
